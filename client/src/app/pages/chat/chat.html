<!-- floating toggle btton -->
<div class="w-screen h-screen bg-blue-300 relative">
  <button
    mat-fab
    color="primary"
    class="fixed top-8 left-2/5 shadow-lg hover:scale-105 transition z-40"
    (click)="toggleChat()"
  >
    @if (!isOpen()) {
    <mat-icon>chat</mat-icon>
    } @else {
    <mat-icon>close</mat-icon>
    }
  </button>

  <!-- chat window -->
  @if (isOpen()) {
  <mat-card
    class="fixed top-12 left-2/5 w-80 h-[480px] rounded-2xl shadow-2xl flex flex-col overflow-hidden z-50"
  >
    <!-- header -->
    <div class="bg-blue-600 text-white flex items-center px-4 py-2">
      <mat-icon class="mr-2">support_agent</mat-icon>
      <div class="flex-1">
        <div class="font-semibold">Support</div>
        <div class="text-xs text-green-300">Online</div>
      </div>
      <button mat-icon-button (click)="toggleChat()">
        <mat-icon class="!text-white">close</mat-icon>
      </button>
    </div>

    <!-- messages -->
    <div class="flex-1 overflow-y-auto bg-gray-50 p-3 flex flex-col">
      @for (msg of messages(); track msg.timestamp) {
      <div
        class="max-w-[75%] px-3 py-2 my-1 rounded-lg text-sm"
        [ngClass]="
          msg.sender === 'user'
            ? 'bg-blue-600 text-white self-end'
            : 'bg-gray-200 text-black self-start'
        "
      >
        {{ msg.text }}
      </div>
      }
    </div>

    <!-- input -->
    <div class="flex items-center border-t border-gray-200 p-2">
      <form [formGroup]="messageForm" (ngSubmit)="onSubmit()" class="flex gap-2 w-full">
        <mat-form-field class="flex-1" appearance="outline">
          <input matInput formControlName="message" placeholder="Type your message..." />
        </mat-form-field>
        <button mat-icon-button color="primary" type="submit">
          <mat-icon>send</mat-icon>
        </button>
      </form>
    </div>
  </mat-card>
  }
</div>
