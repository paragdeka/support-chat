<div class="mt-8 overflow-scroll h-[calc(100vh-96px)]">
  <div class="mat-elevation-z4 flex flex-col items-center overflow-hidden">
    <h2 class="text-2xl mb-4">All Tickets</h2>
    @if (isFetching()) {
    <mat-spinner />
    }@else {
    <mat-table [dataSource]="dataSource" matSort>
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
        <td mat-cell *matCellDef="let ticket">{{ ticket.id.slice(-6) }}</td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
        <td mat-cell *matCellDef="let ticket">
          <span
            class="px-3 py-0.5 rounded-xl text-white"
            [ngClass]="{
              'bg-red-500!': ticket.status === 'open',
              'bg-amber-500!': ticket.status === 'in-progress',
              'bg-green-600!': ticket.status === 'closed'
            }"
            >{{ ticket.status }}</span
          >
        </td>
      </ng-container>

      <ng-container matColumnDef="customerName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Customer</th>
        <td mat-cell *matCellDef="let ticket">{{ ticket.customerName | titlecase }}</td>
      </ng-container>

      <ng-container matColumnDef="issue">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Issue</th>
        <td mat-cell *matCellDef="let ticket">
          {{ ticket.issue.length > 60 ? ticket.issue.substring(0, 60) + '...' : ticket.issue }}
        </td>
      </ng-container>

      <ng-container matColumnDef="priority">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Priority</th>
        <td
          mat-cell
          *matCellDef="let ticket"
          [ngClass]="{
            'bg-blue-500!': ticket.priority === 'high',
            'bg-blue-300!': ticket.priority === 'medium',
            'bg-blue-100!': ticket.priority === 'low'
          }"
        >
          {{ ticket.priority | titlecase }}
        </td>
      </ng-container>

      <ng-container matColumnDef="createdAt">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Created</th>
        <td mat-cell *matCellDef="let ticket">{{ ticket.createdAt }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columns"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: columns"
        (click)="onRowClick(row)"
        class="hover:bg-gray-200! cursor-pointer!"
      ></tr>
    </mat-table>
    }
  </div>
</div>
