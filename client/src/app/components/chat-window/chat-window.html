<div class="w-120 h-[480px] border-1 border-gray-300 flex flex-col overflow-hidden z-50">
  <!-- header -->
  <!-- <div class="bg-blue-600 text-white flex items-center px-4 py-2">
    <mat-icon class="mr-2">support_agent</mat-icon>
    <div class="flex-1">
      <div class="font-semibold">Support</div>
      <div class="text-xs text-green-300">Online</div>
    </div>
  </div> -->

  <!-- messages -->
  <div class="flex-1 overflow-y-auto bg-gray-50 p-3 flex flex-col">
    @for (msg of messagesInput(); track msg.id) {
    <div class="flex mb-4">
      @if (msg.sender !== self()) {
      <div class="rounded-full w-8 h-8 bg-green-700 flex justify-center items-center">
        @if (msg.sender === 'system') {
        <mat-icon class="text-white!">smart_toy</mat-icon>
        }
        <p class="text-white text-xl">
          {{
          msg.sender === 'customer'
            ? msg.customerName?.[0]?.toUpperCase()
            : msg.sender === 'agent'
            ? msg.agentName?.[0]?.toUpperCase()
            : ''
          }}
        </p>
      </div>
      }
      <div class="ml-2 flex-1">
        <div class="flex flex-col">
          <p [ngClass]="{ 'self-end pr-2': msg.sender === self() }" class="text-gray-500 text-xs">
            {{
              msg.sender === self()
                ? 'You'
                : msg.sender === 'customer'
                ? (msg.customerName | titlecase)
                : msg.sender === 'agent'
                ? (msg.agentName | titlecase)
                : 'System'
            }}
          </p>
          <div
            class="inline-block max-w-[75%] px-3 py-2 my-1 rounded-lg text-sm"
            [ngClass]="
              msg.sender === self()
                ? 'bg-blue-600 text-white self-end'
                : 'bg-gray-200 text-black self-start'
            "
          >
            {{ msg.text }}
          </div>
        </div>
      </div>
    </div>
    }
  </div>

  <!-- input -->
  <div class="flex items-center border-t border-gray-200 p-2">
    <form [formGroup]="messageForm" (ngSubmit)="onSubmit()" class="flex gap-2 w-full">
      <mat-form-field class="flex-1" appearance="outline">
        <input matInput formControlName="message" placeholder="Type your message..." />
      </mat-form-field>
      <button mat-icon-button color="primary" type="submit">
        <mat-icon>send</mat-icon>
      </button>
    </form>
  </div>
</div>
